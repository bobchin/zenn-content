---
title: "Gitまとめ"
emoji: "💭"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [Git]
published: false
---

## 用語

- 作業ディレクトリ（ワーキングツリー）
- ステージングエリア（.git/index）
- ローカルリポジトリ（.git）
- コミット履歴
  - コミット（スナップショット）
  - コミットハッシュ（ID）

- 未追跡ファイル(untracked file)
- 追跡済みファイル(tracked file)
  - 未変更ファイル(unmodified file)
  - 変更済みファイル(modified file)

- ブランチ(.git/.refs/heads/xxx)
  - main(.git/.refs/heads/main)
- HEAD(.git/HEAD)
  :::message
  detached HEAD
  "HEAD" が**ブランチ**ではなく**特定のコミット**を指している状態
  :::

- ソースブランチ: マージ元（変更のある）ブランチ
- ターゲットブランチ: マージ先のブランチ
- リモートブランチ: リモートのブランチ
- リモート追跡ブランチ: ローカル上でリモートを指しているブランチ
- 上流ブランチ: リモート追跡ブランチとリモートブランチの指している状態

- マージ
  - 早送りマージ(fast-forward merge)
  - ３方向マージ(three-way merge)

- マージコンフリクト
- コンフリクトマーカー

- リベース
  :::message
  ステップ
  1. 共通の祖先を探す
  2. リベースに関係するブランチの情報を保存する
  3. HEAD をリセットする
  4. 変更を適用し、コミットを作成する
  5. リベース元のブランチに切り替える
  :::

- プルリクエスト(マージリクエスト)


## コマンド

### config

```bash:config
# 確認
git config --list

# 必須
git config --global user.name "bobchin"
git config --global user.email "bobchin.ryu@gmail.com"

# 任意
git config init.defaultBranch main    # 初期ブランチ名
git config core.editor "code --wail"  # 編集用エディタ指定
```

### init

```bash:init
# ローカルから始める
git init -b main

# リモートリポジトリから取得
git clone <URL> [<directory name>]
```

### status

```bash:status
git status

git log         # 自分のリポジトリだけ表示
git log --all   # リモートリポジトリも含める

git cat-file -p <hashkey>
```

### add & commit

```bash:add&commit
git add <filename> [<filename>]   # ファイル指定
git add <dir>                     # ディレクトリ指定
git -A                            # ステージングエリアで編集したファイルすべて追加

# example
git rainbowcolors.txt
git .
git -A  # ステージングエリアで編集したファイルすべて追加

# commit
git commit -m "comment"

git commit --amend              # 直線コミットの修正
git restore --staged <filename> # ステージングエリアからファイルを削除

git reset
  --mixed <commit>  # commit と add を取り消す
  --soft            # commit のみ取り消す
  --hard            # すべてなかったことにする
```

### branch

```bash:branch
git branch [<branch>]
git switch <branch>

# 新しいブランチを作成して移動
git switch -c <new branch>
git checkout -b <new branch>
```

### merge

```bash:merge
# マージはターゲットブランチ=マージを反映するブランチで実行する
git switch <target branch>
git merge <source branch>

git merge --abort   # マージを辞める
```

### remote

```bash:remote
# リモートブランチを指定
git remote add <shortname> <URL>

# リモートブランチの確認
git remote
git remote -v

# リモートブランチへ反映
git push <shortname> <branch>
# まだリモート追跡ブランチが指定されていない場合
git push --set-upstream <shortname> <branch>

git branch -vv                      # リモート追跡ブランチを確認
git branch -u <shortname>/<branch>  # リモート追跡ブランチを指定

# リモートブランチを反映
git fetch [<shortname>]

git pull [<shortname> <branch>]
 --no-rebase = git fetch + git merge
 --rebase    = git fetch + git rebase

# delete
git push <shortname> -d <branch>  # リモートブランチとリモート追跡ブランチの削除
git fetch -p                      # 削除されたリモートブランチに対応するリモート追跡ブランチを削除
git branch -d <branch>            # ローカルブランチの削除
```

### rebase

```bash:rebase
# rebase
git rebase <target branch>  # リベース元のブランチに移動して実行
git rebase --continue
git rebase --abort
```

## やり直し関係

### staged => workbench

```bash
git restore --staged <filename>
```

### reset

- --mixed <commit>: デフォルト。ステージングエリアはリセット。ワークスペースはそのまま。
  git add する前の状態になる？
- --soft <commit> : HEAD を <commit> に戻すのみ。ファイルはステージ状態になる。
  git commit する前の状態になる？
- --hard <commit> : ステージングエリアをリセットして、<commit> と <HEAD> 間の違いをワークスペースに。
  <commit> が作られたすぐの状態になる？（ステージングエリアもワークスペースもない）

```bash
git add README.txt
git commit -m "first commit"

### status1 ###

# file.txt 追加・編集

### status2 ###
git add file.txt
### status3 ###
git commit -m "add file.txt"

git reset --soft HEAD~1 # status3 の状態
git reset --mixed HEAD~1 # status2 の状態
git reset --soft HEAD~1 # status1 の状態
```

### reflog

- `git reflog` : reset で見えなくなったコミットを探す

```bash
git reflog
git reset --hard <commit>
```

### revert

コミットを打ち消す。
打ち消しコミットが作成される。

```bash
git revert <commit>
```

### merge

- --merge : コミットをマージする
- --rebase: コミットをブランチの先頭にリベースする
- --squash: コミットを１つにまとめてマージする

### blame

確認する？

```bash
git blame <filename>
```

### bisect

バグを混入させてしまったコミットを探す

```bash
git blame <filename>
```

## Links

- つくって、壊して、直して学ぶ Git＆GitHub 入門

https://www.shoeisha.co.jp/book/detail/9784798191584

- サル先生のGit入門

https://backlog.com/ja/git-tutorial/

- ゼロから学ぶGit/GitHub 現代的なソフトウェア開発のために

https://www.amazon.co.jp/%E3%82%BC%E3%83%AD%E3%81%8B%E3%82%89%E5%AD%A6%E3%81%B6Git-GitHub-%E7%8F%BE%E4%BB%A3%E7%9A%84%E3%81%AA%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E9%96%8B%E7%99%BA%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AB-KS%E6%83%85%E5%A0%B1%E7%A7%91%E5%AD%A6%E5%B0%82%E9%96%80%E6%9B%B8-%E6%B8%A1%E8%BE%BA/dp/4065352193



